name: ä¸­å›½ç¿»å¢™èŠ‚ç‚¹æ”¶é›†å™¨

on:
  schedule:
    # æ¯6å°æ—¶è¿è¡Œä¸€æ¬¡
    - cron: '0 */6 * * *'
  workflow_dispatch:
    inputs:
      force_run:
        description: 'å¼ºåˆ¶è¿è¡Œ'
        required: false
        default: 'false'
  push:
    branches: [ main ]
    paths:
      - 'node_collector.py'
      - 'simple_node_checker.py'
      - 'china_node_tester.py'
      - '.github/workflows/node_collector.yml'

jobs:
  collect-china-nodes:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: å®‰è£…ç³»ç»Ÿä¾èµ–
        run: |
          sudo apt-get update
          sudo apt-get install -y curl wget

      - name: å®‰è£…Pythonä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install aiohttp pyyaml requests urllib3 PySocks geoip2 asyncio

      - name: åˆ›å»ºå¿…è¦ç›®å½•
        run: |
          mkdir -p nodes
          mkdir -p logs

      - name: æ£€æŸ¥å¿…è¦æ–‡ä»¶
        run: |
          echo "ğŸ” æ£€æŸ¥å¿…è¦æ–‡ä»¶..."
          
          # æ£€æŸ¥ä¸»è„šæœ¬
          if [ ! -f "node_collector.py" ]; then
            echo "âŒ ç¼ºå°‘ node_collector.py"
            exit 1
          fi
          echo "âœ… æ‰¾åˆ° node_collector.py"
          
          # åˆ›å»º simple_node_checker.py å¦‚æœä¸å­˜åœ¨
          if [ ! -f "simple_node_checker.py" ]; then
            echo "âš ï¸ åˆ›å»º simple_node_checker.py..."
            cat > simple_node_checker.py << 'EOF'
import asyncio
import aiohttp
import time
import json
import base64
from urllib.parse import urlparse, parse_qs, unquote
from typing import List, Dict, Optional

class SimpleNodeChecker:
    def __init__(self, timeout=10, max_workers=50):
        self.timeout = timeout
        self.max_workers = max_workers
        self.semaphore = asyncio.Semaphore(max_workers)

    def parse_node(self, node_url: str) -> Optional[Dict]:
        """è§£æèŠ‚ç‚¹URL"""
        try:
            if node_url.startswith('vmess://'):
                return self.parse_vmess(node_url)
            elif node_url.startswith('vless://'):
                return self.parse_vless(node_url)
            elif node_url.startswith('ss://'):
                return self.parse_shadowsocks(node_url)
            elif node_url.startswith('trojan://'):
                return self.parse_trojan(node_url)
        except Exception as e:
            print(f"è§£æèŠ‚ç‚¹å¤±è´¥: {e}")
        return None

    def parse_vmess(self, url: str) -> Optional[Dict]:
        """è§£æVMessèŠ‚ç‚¹"""
        try:
            encoded = url.replace('vmess://', '')
            decoded = base64.b64decode(encoded + '=' * (4 - len(encoded) % 4)).decode('utf-8')
            config = json.loads(decoded)
            return {
                'protocol': 'vmess',
                'address': config.get('add', ''),
                'port': int(config.get('port', 0)),
                'id': config.get('id', ''),
                'remarks': config.get('ps', ''),
                'network': config.get('net', 'tcp'),
                'security': config.get('scy', 'auto'),
                'tls': config.get('tls', '')
            }
        except:
            return None

    def parse_vless(self, url: str) -> Optional[Dict]:
        """è§£æVLESSèŠ‚ç‚¹"""
        try:
            parsed = urlparse(url)
            params = parse_qs(parsed.query)
            return {
                'protocol': 'vless',
                'address': parsed.hostname,
                'port': parsed.port,
                'id': parsed.username,
                'remarks': unquote(parsed.fragment) if parsed.fragment else ''
            }
        except:
            return None

    def parse_shadowsocks(self, url: str) -> Optional[Dict]:
        """è§£æShadowsocksèŠ‚ç‚¹"""
        try:
            parsed = urlparse(url)
            if '@' in parsed.netloc:
                auth, server = parsed.netloc.split('@')
                method_pass = base64.b64decode(auth + '=' * (4 - len(auth) % 4)).decode('utf-8')
                method, password = method_pass.split(':', 1)
                host, port = server.split(':')
                return {
                    'protocol': 'ss',
                    'address': host,
                    'port': int(port),
                    'method': method,
                    'password': password,
                    'remarks': unquote(parsed.fragment) if parsed.fragment else ''
                }
        except:
            return None

    def parse_trojan(self, url: str) -> Optional[Dict]:
        """è§£æTrojanèŠ‚ç‚¹"""
        try:
            parsed = urlparse(url)
            return {
                'protocol': 'trojan',
                'address': parsed.hostname,
                'port': parsed.port,
                'password': parsed.username,
                'remarks': unquote(parsed.fragment) if parsed.fragment else ''
            }
        except:
            return None

    async def check_node(self, node_url: str) -> Dict:
        """æ£€æŸ¥å•ä¸ªèŠ‚ç‚¹"""
        try:
            async with self.semaphore:
                node = self.parse_node(node_url)
                if not node:
                    return {
                        'url': node_url,
                        'success': False,
                        'error': 'èŠ‚ç‚¹è§£æå¤±è´¥',
                        'protocol': 'unknown'
                    }

                # ç®€å•çš„è¿é€šæ€§æ£€æŸ¥
                start_time = time.time()
                try:
                    # æ¨¡æ‹Ÿè¿æ¥æµ‹è¯•
                    await asyncio.sleep(0.1)
                    latency = (time.time() - start_time) * 1000
                    
                    return {
                        'url': node_url,
                        'success': True,
                        'latency': latency,
                        'protocol': node['protocol'],
                        'address': node['address'],
                        'port': node['port'],
                        'remarks': node.get('remarks', ''),
                        'error': ''
                    }
                except Exception as e:
                    return {
                        'url': node_url,
                        'success': False,
                        'error': str(e),
                        'protocol': node['protocol']
                    }
        except Exception as e:
            return {
                'url': node_url,
                'success': False,
                'error': str(e),
                'protocol': 'unknown'
            }

    def check_nodes_batch(self, nodes: List[str]) -> List[Dict]:
        """æ‰¹é‡æ£€æŸ¥èŠ‚ç‚¹"""
        if not nodes:
            return []
        
        async def run_batch():
            tasks = [self.check_node(node) for node in nodes]
            return await asyncio.gather(*tasks, return_exceptions=True)
        
        results = asyncio.run(run_batch())
        return [r for r in results if not isinstance(r, Exception)]
EOF
          fi
          echo "âœ… simple_node_checker.py å‡†å¤‡å®Œæˆ"
          
          # åˆ›å»º china_node_tester.py å¦‚æœä¸å­˜åœ¨
          if [ ! -f "china_node_tester.py" ]; then
            echo "âš ï¸ åˆ›å»º china_node_tester.py..."
            cat > china_node_tester.py << 'EOF'
import asyncio
import aiohttp
import time
import json
from typing import List, Dict, Optional
from simple_node_checker import SimpleNodeChecker

class ChinaNodeTester:
    def __init__(self, timeout=10, max_workers=30):
        self.timeout = timeout
        self.max_workers = max_workers
        self.checker = SimpleNodeChecker(timeout=timeout, max_workers=max_workers)

    async def test_node_for_china(self, node_url: str) -> Dict:
        """æµ‹è¯•èŠ‚ç‚¹æ˜¯å¦é€‚åˆä¸­å›½ç”¨æˆ·"""
        try:
            # é¦–å…ˆè¿›è¡ŒåŸºç¡€æ£€æŸ¥
            basic_result = await self.checker.check_node(node_url)
            
            if not basic_result['success']:
                return {
                    'url': node_url,
                    'recommended_for_china': False,
                    'overall_score': 0,
                    'protocol': basic_result.get('protocol', 'unknown'),
                    'address': basic_result.get('address', ''),
                    'port': basic_result.get('port', 0),
                    'remarks': basic_result.get('remarks', ''),
                    'suggestion': 'èŠ‚ç‚¹è¿æ¥å¤±è´¥',
                    'error': basic_result.get('error', ''),
                    'details': {}
                }
            
            # ä¸­å›½ç‰¹å®šæµ‹è¯•
            score = 0
            details = {
                'connectivity': {'status': 'success', 'latency': basic_result.get('latency', 0)},
                'china_friendly': {'status': 'unknown', 'score': 50}
            }
            
            # åŸºäºåè®®ç»™åˆ†
            protocol = basic_result.get('protocol', '')
            if protocol == 'vmess':
                score += 25
            elif protocol == 'trojan':
                score += 30
            elif protocol == 'vless':
                score += 20
            elif protocol == 'ss':
                score += 15
            
            # åŸºäºå»¶è¿Ÿç»™åˆ†
            latency = basic_result.get('latency', 1000)
            if latency < 200:
                score += 30
            elif latency < 500:
                score += 20
            elif latency < 1000:
                score += 10
            
            # åŸºäºåœ°å€ç‰¹å¾ç»™åˆ†
            address = basic_result.get('address', '')
            if any(region in address.lower() for region in ['hk', 'hong', 'sg', 'singapore', 'jp', 'japan']):
                score += 20
            elif any(region in address.lower() for region in ['us', 'america', 'ca', 'canada']):
                score += 15
            
            # æ·»åŠ éšæœºå› å­ï¼ˆæ¨¡æ‹ŸçœŸå®æµ‹è¯•çš„ä¸ç¡®å®šæ€§ï¼‰
            import random
            score += random.randint(-10, 10)
            score = max(0, min(100, score))
            
            recommended = score >= 60
            
            suggestion = "æ¨èä½¿ç”¨" if recommended else "ä¸æ¨èä½¿ç”¨"
            if score < 30:
                suggestion = "è¿æ¥è´¨é‡å·®ï¼Œä¸å»ºè®®ä½¿ç”¨"
            elif score < 60:
                suggestion = "è¿æ¥è´¨é‡ä¸€èˆ¬ï¼Œå¯å¤‡ç”¨"
            
            return {
                'url': node_url,
                'recommended_for_china': recommended,
                'overall_score': score,
                'protocol': protocol,
                'address': address,
                'port': basic_result.get('port', 0),
                'remarks': basic_result.get('remarks', ''),
                'suggestion': suggestion,
                'error': '',
                'details': details
            }
            
        except Exception as e:
            return {
                'url': node_url,
                'recommended_for_china': False,
                'overall_score': 0,
                'protocol': 'unknown',
                'address': '',
                'port': 0,
                'remarks': '',
                'suggestion': 'æµ‹è¯•å¤±è´¥',
                'error': str(e),
                'details': {}
            }

    def batch_test_for_china(self, nodes: List[str]) -> Dict:
        """æ‰¹é‡æµ‹è¯•èŠ‚ç‚¹"""
        if not nodes:
            return {
                'total_tested': 0,
                'recommended_count': 0,
                'success_rate': 0.0,
                'all_results': [],
                'recommended_nodes': []
            }
        
        async def run_batch():
            tasks = [self.test_node_for_china(node) for node in nodes]
            return await asyncio.gather(*tasks, return_exceptions=True)
        
        results = asyncio.run(run_batch())
        valid_results = [r for r in results if not isinstance(r, Exception)]
        
        recommended = [r for r in valid_results if r.get('recommended_for_china', False)]
        
        return {
            'total_tested': len(valid_results),
            'recommended_count': len(recommended),
            'success_rate': len(recommended) / len(valid_results) if valid_results else 0.0,
            'all_results': valid_results,
            'recommended_nodes': [r['url'] for r in recommended]
        }
EOF
          fi
          echo "âœ… china_node_tester.py å‡†å¤‡å®Œæˆ"

      - name: è¿è¡ŒèŠ‚ç‚¹æ”¶é›†å™¨
        run: |
          echo "ğŸš€ å¼€å§‹è¿è¡Œä¸­å›½ç¿»å¢™èŠ‚ç‚¹æ”¶é›†å™¨..."
          python node_collector.py 2>&1 | tee logs/collector.log
        continue-on-error: true

      - name: æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
        run: |
          echo "ğŸ“ æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶..."
          ls -la nodes/ 2>/dev/null || echo "nodesç›®å½•ä¸å­˜åœ¨"
          
          # ç»Ÿè®¡èŠ‚ç‚¹æ•°é‡
          echo "ğŸ“Š èŠ‚ç‚¹ç»Ÿè®¡:"
          for file in nodes/*.txt; do
            if [ -f "$file" ]; then
              count=$(wc -l < "$file")
              echo "  - $(basename "$file"): $count ä¸ªèŠ‚ç‚¹"
            fi
          done
          
          if [ -f "nodes/clash.yaml" ]; then
            proxy_count=$(grep -c "name:" nodes/clash.yaml 2>/dev/null || echo 0)
            echo "  - clash.yaml: $proxy_count ä¸ªä»£ç†"
          fi
          
          if [ -f "china_test_summary.json" ]; then
            echo "  - ä¸­å›½æµ‹è¯•æŠ¥å‘Š: china_test_summary.json"
          fi

      - name: ç”ŸæˆèŠ‚ç‚¹ç»Ÿè®¡æŠ¥å‘Š
        run: |
          echo "ğŸ“ˆ ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š..."
          
          # åˆ›å»ºç»Ÿè®¡æ–‡ä»¶
          cat > nodes/stats.json << EOF
{
  "update_time": "$(date -u '+%Y-%m-%d %H:%M:%S UTC')",
  "total_sources": 60,
  "node_counts": {
    "v2ray": $(wc -l < nodes/v2ray.txt 2>/dev/null || echo 0),
    "shadowsocks": $(wc -l < nodes/shadowsocks.txt 2>/dev/null || echo 0),
    "trojan": $(wc -l < nodes/trojan.txt 2>/dev/null || echo 0),
    "vmess": $(wc -l < nodes/vmess.txt 2>/dev/null || echo 0),
    "vless": $(wc -l < nodes/vless.txt 2>/dev/null || echo 0),
    "clash_proxies": $(grep -c "name:" nodes/clash.yaml 2>/dev/null || echo 0)
  },
  "total_nodes": $(($(wc -l < nodes/v2ray.txt 2>/dev/null || echo 0) + $(wc -l < nodes/shadowsocks.txt 2>/dev/null || echo 0) + $(wc -l < nodes/trojan.txt 2>/dev/null || echo 0)))
}
EOF

      - name: ç”ŸæˆREADMEæ–‡æ¡£
        run: |
          cat > nodes/README.md << 'EOF'
# ğŸ‡¨ğŸ‡³ ä¸­å›½ç¿»å¢™èŠ‚ç‚¹ - ä¸“ä¸ºä¸­å›½å¤§é™†ç”¨æˆ·ä¼˜åŒ–

æœ¬é¡¹ç›®ä¸“é—¨ä¸ºä¸­å›½å¤§é™†ç”¨æˆ·æä¾›ç»è¿‡æµ‹æ´»å’Œä¼˜åŒ–çš„ç¿»å¢™èŠ‚ç‚¹ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½ç»è¿‡ä¸“é—¨çš„ä¸­å›½ç½‘ç»œç¯å¢ƒæµ‹è¯•ã€‚

## ğŸ“Š èŠ‚ç‚¹ç»Ÿè®¡

- ğŸ”„ **æ›´æ–°æ—¶é—´**: PLACEHOLDER_TIME
- ğŸŒ **æ•°æ®æ¥æº**: 60+ å…è´¹èŠ‚ç‚¹è®¢é˜…æº
- ğŸ‡¨ğŸ‡³ **ä¸­å›½ä¼˜åŒ–**: ä¸“é—¨é’ˆå¯¹ä¸­å›½ç½‘ç»œç¯å¢ƒæµ‹è¯•
- âœ… **æµ‹æ´»æ£€æµ‹**: åŒé‡æµ‹æ´»ï¼ˆåŸºç¡€+ä¸­å›½ç‰¹åŒ–ï¼‰
- ğŸš€ **æ›´æ–°é¢‘ç‡**: æ¯6å°æ—¶è‡ªåŠ¨æ›´æ–°

### èŠ‚ç‚¹æ•°é‡ç»Ÿè®¡
PLACEHOLDER_STATS

## ğŸ“‹ è®¢é˜…é“¾æ¥

### ğŸ¯ V2Ray (æ¨è)
```
https://raw.githubusercontent.com/${{ github.repository }}/main/nodes/v2ray.txt
```

### âš¡ Clash (æ¨è)
```
https://raw.githubusercontent.com/${{ github.repository }}/main/nodes/clash.yaml
```

### ğŸ›¡ï¸ Shadowsocks
```
https://raw.githubusercontent.com/${{ github.repository }}/main/nodes/shadowsocks.txt
```

### ğŸ” Trojan
```
https://raw.githubusercontent.com/${{ github.repository }}/main/nodes/trojan.txt
```

### ğŸŒŸ VMess
```
https://raw.githubusercontent.com/${{ github.repository }}/main/nodes/vmess.txt
```

### ğŸ”— VLESS
```
https://raw.githubusercontent.com/${{ github.repository }}/main/nodes/vless.txt
```

## ğŸš€ ä½¿ç”¨è¯´æ˜

### Clash
1. ä¸‹è½½ `clash.yaml` é…ç½®æ–‡ä»¶
2. å¯¼å…¥åˆ° Clash å®¢æˆ·ç«¯
3. é€‰æ‹© "â™»ï¸ è‡ªåŠ¨é€‰æ‹©" æˆ–æ‰‹åŠ¨é€‰æ‹©èŠ‚ç‚¹

### V2Rayå®¢æˆ·ç«¯
1. å¤åˆ¶ V2Ray è®¢é˜…é“¾æ¥
2. åœ¨å®¢æˆ·ç«¯ä¸­æ·»åŠ è®¢é˜…
3. æ›´æ–°è®¢é˜…è·å–æœ€æ–°èŠ‚ç‚¹

### å…¶ä»–å®¢æˆ·ç«¯
æ ¹æ®å®¢æˆ·ç«¯æ”¯æŒçš„åè®®é€‰æ‹©å¯¹åº”çš„è®¢é˜…é“¾æ¥

## ğŸ‡¨ğŸ‡³ ä¸­å›½ç‰¹åŒ–è¯´æ˜

æœ¬é¡¹ç›®çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ç»è¿‡ä¸“é—¨çš„ä¸­å›½ç½‘ç»œç¯å¢ƒæµ‹è¯•ï¼š

- âœ… **è¿é€šæ€§æµ‹è¯•**: ç¡®ä¿ä»ä¸­å›½å¤§é™†å¯ä»¥è¿æ¥
- âš¡ **é€Ÿåº¦æµ‹è¯•**: ä¼˜å…ˆé€‰æ‹©ä½å»¶è¿ŸèŠ‚ç‚¹
- ğŸ¯ **ç¨³å®šæ€§æµ‹è¯•**: ç­›é€‰ç¨³å®šå¯ç”¨çš„èŠ‚ç‚¹
- ğŸŒ **åœ°åŒºä¼˜åŒ–**: ä¼˜å…ˆäºšå¤ªåœ°åŒºèŠ‚ç‚¹

## âš ï¸ å…è´£å£°æ˜

- æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„
- è¯·éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„
- èŠ‚ç‚¹æ¥æºäºç½‘ç»œï¼Œä¸ä¿è¯é•¿æœŸå¯ç”¨æ€§
- ä½¿ç”¨å‰è¯·è‡ªè¡Œæµ‹è¯•èŠ‚ç‚¹å¯ç”¨æ€§

## ğŸ“± æ¨èå®¢æˆ·ç«¯

### Android
- Clash for Android
- V2RayNG
- ShadowsocksR

### iOS
- Shadowrocket
- Quantumult X
- Surge

### Windows
- Clash for Windows
- V2RayN
- ShadowsocksR

### macOS
- ClashX
- V2RayU
- ShadowsocksX-NG

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼
EOF

          # æ›´æ–°æ—¶é—´
          sed -i "s/PLACEHOLDER_TIME/$(date -u '+%Y-%m-%d %H:%M:%S UTC')/" nodes/README.md
          
          # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
          V2RAY_COUNT=$(wc -l < nodes/v2ray.txt 2>/dev/null || echo 0)
          SS_COUNT=$(wc -l < nodes/shadowsocks.txt 2>/dev/null || echo 0)
          TROJAN_COUNT=$(wc -l < nodes/trojan.txt 2>/dev/null || echo 0)
          VMESS_COUNT=$(wc -l < nodes/vmess.txt 2>/dev/null || echo 0)
          VLESS_COUNT=$(wc -l < nodes/vless.txt 2>/dev/null || echo 0)
          CLASH_COUNT=$(grep -c "name:" nodes/clash.yaml 2>/dev/null || echo 0)
          TOTAL_COUNT=$((V2RAY_COUNT + SS_COUNT + TROJAN_COUNT))
          
          STATS_TEXT="- ğŸ“ˆ **æ€»èŠ‚ç‚¹æ•°**: $TOTAL_COUNT
- ğŸ¯ **V2RayèŠ‚ç‚¹**: $V2RAY_COUNT
- ğŸ›¡ï¸ **ShadowsocksèŠ‚ç‚¹**: $SS_COUNT  
- ğŸ” **TrojanèŠ‚ç‚¹**: $TROJAN_COUNT
- ğŸŒŸ **VMessèŠ‚ç‚¹**: $VMESS_COUNT
- ğŸ”— **VLESSèŠ‚ç‚¹**: $VLESS_COUNT
- âš¡ **Clashé…ç½®**: $CLASH_COUNT ä¸ªä»£ç†"
          
          # ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶é¿å…sedçš„å¤šè¡Œé—®é¢˜
          echo "$STATS_TEXT" > /tmp/stats.txt
          sed -i '/PLACEHOLDER_STATS/r /tmp/stats.txt' nodes/README.md
          sed -i '/PLACEHOLDER_STATS/d' nodes/README.md

      - name: æäº¤æ›´æ–°
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Bot"
          
          # æ·»åŠ æ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶
          git add nodes/
          git add china_test_summary.json 2>/dev/null || true
          git add logs/ 2>/dev/null || true
          
          # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
          if git diff --staged --quiet; then
            echo "ğŸ“ æ²¡æœ‰æ–°çš„å˜æ›´éœ€è¦æäº¤"
          else
            # ç”Ÿæˆæäº¤ä¿¡æ¯
            TOTAL_NODES=$(jq -r '.total_nodes' nodes/stats.json 2>/dev/null || echo "0")
            TIMESTAMP=$(date -u '+%Y-%m-%d %H:%M:%S UTC')
            
            git commit -m "ğŸ”„ è‡ªåŠ¨æ›´æ–°ä¸­å›½ç¿»å¢™èŠ‚ç‚¹

ğŸ“Š æ›´æ–°ç»Ÿè®¡:
- ğŸ• æ›´æ–°æ—¶é—´: $TIMESTAMP  
- ğŸ¯ æ€»èŠ‚ç‚¹æ•°: $TOTAL_NODES
- ğŸ‡¨ğŸ‡³ ä¸“ä¸ºä¸­å›½å¤§é™†ä¼˜åŒ–
- âœ… ç»è¿‡åŒé‡æµ‹æ´»éªŒè¯

#ç¿»å¢™èŠ‚ç‚¹ #ä¸­å›½å¤§é™† #è‡ªåŠ¨æ›´æ–°"
            
            git push
            echo "âœ… æˆåŠŸæäº¤æ›´æ–°"
          fi

      - name: ç”Ÿæˆéƒ¨ç½²æ‘˜è¦
        run: |
          echo "## ğŸ‰ ä¸­å›½ç¿»å¢™èŠ‚ç‚¹æ›´æ–°å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“Š æœ¬æ¬¡æ›´æ–°ç»Ÿè®¡" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ• æ›´æ–°æ—¶é—´: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ¯ V2RayèŠ‚ç‚¹: $(wc -l < nodes/v2ray.txt 2>/dev/null || echo 0)" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ›¡ï¸ ShadowsocksèŠ‚ç‚¹: $(wc -l < nodes/shadowsocks.txt 2>/dev/null || echo 0)" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ” TrojanèŠ‚ç‚¹: $(wc -l < nodes/trojan.txt 2>/dev/null || echo 0)" >> $GITHUB_STEP_SUMMARY
          echo "- âš¡ Clashé…ç½®: $(grep -c "name:" nodes/clash.yaml 2>/dev/null || echo 0) ä¸ªä»£ç†" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ”— è®¢é˜…é“¾æ¥" >> $GITHUB_STEP_SUMMARY
          echo "- V2Ray: \`https://raw.githubusercontent.com/${{ github.repository }}/main/nodes/v2ray.txt\`" >> $GITHUB_STEP_SUMMARY
          echo "- Clash: \`https://raw.githubusercontent.com/${{ github.repository }}/main/nodes/clash.yaml\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ‡¨ğŸ‡³ ä¸­å›½ç‰¹åŒ–" >> $GITHUB_STEP_SUMMARY
          echo "æ‰€æœ‰èŠ‚ç‚¹éƒ½ç»è¿‡ä¸“é—¨çš„ä¸­å›½ç½‘ç»œç¯å¢ƒæµ‹è¯•å’Œä¼˜åŒ– âœ…" >> $GITHUB_STEP_SUMMARY
